var singleInstance=function(window){var methodName="__methodName",argsValue="__argsValue",options="",features="";var methodNameForShort="__m",argsValueForShort="__a",optionValue="__o",frValue="fr";var connectName="_baidu_music_naga_",singleName=connectName+"box",bridgeName=connectName+"bridge",id=0,slcMessageAccess="_baidu_naga_slc_messageaccess";var pageserver="http://music.baidu.com",boxserver="http://play.baidu.com",path="/",bridgePath="/player/bridge.html",proxyPath="/player/boxproxy.html";var swfUrl=boxserver+"/player/static/flash/SLC.swf";var encode=function(args){var args=args||"";return encodeURIComponent(args.toString())};var methodJson={"mbc.ps":"playSong","mbc.as":"addSong","mbc.pa":"playAlbum","mbc.aa":"addAlbum","mbc.pd":"playDiy","mbc.ad":"addDiy","mbc.pt":"playTop","mbc.at":"addTop","mbc.pb":"playBubble","mbc.ab":"addBubble","mboxCtrl.playSong":"playSong","mboxCtrl.addSong":"addSong","mboxCtrl.playAlbum":"playAlbum","mboxCtrl.addAlbum":"addAlbum","mboxCtrl.playDiy":"playDiy","mboxCtrl.addDiy":"addDiy","mboxCtrl.playTop":"playTop","mboxCtrl.addTop":"addTop","mboxCtrl.playBubble":"playBubble","mboxCtrl.addBubble":"addBubble","mboxCtrl.playLocal":"playLocal","mboxCtrl.playLatest":"playLatest","mboxCtrl.playCollection":"playCollection"};var getSearchArgs=function(search){search=search?search:window.location.search;var qs=search.length>0?search.substring(1):"",args={},items=qs.split("&"),len=items.length;for(var i=0;i<len;i++){var item=items[i].split("="),name=item[0],value=item[1];args[name]=value}return args};var validatorArgs=function(url){var reg=/[<>]/gi;return!reg.test(url)};var checkFlash=function(version){var needVersion="9.0.0";var vUnit1,vUnit2;if(version){version=version.split(".");needVersion=needVersion.split(".");for(var i=0;i<3;i++){vUnit1=parseInt(version[i],10);vUnit2=parseInt(needVersion[i],10);if(vUnit2<vUnit1){return true}else if(vUnit2>vUnit1){return false}}return true}else{return false}}($.swf.version);var getArgs=function(){return location.search};var getArgsJSON=function(){return getSearchArgs()};var getLoaded=function(){return window.location.hash.indexOf("#loaded")<0};var setLoaded=function(){window.location.hash="loaded"};var Fuze=function(){var queue,fn,infire;queue=[];fn=function(process){if(infire){process()}else{queue.push(process)}};fn.fire=function(){while(queue.length){queue.shift()()}infire=true};fn.extinguish=function(){infire=false};fn.wettish=function(){this.fire();this.extinguish()};fn.clear=function(){while(queue.length){queue.shift()}this.extinguish()};return fn};var fn=function(){this.hasCommandByUrl=false;this.init()};fn.prototype={init:function(options){if(checkFlash){this.flashId="";this.flashFuze=new Fuze;var con=document.createElement("div");$(con).attr({});$.swf.create({id:this.flashId=connectName+"flash_"+id++,url:swfUrl+"?r="+Math.random(),width:"1",height:"1",allowScriptAccess:"always",ver:"9.0.0"},con);document.body.appendChild(con);this.flashObj=$.swf.getMovie(this.flashId);var me=this;this.flashInterval=window.setInterval(function(){if(me.flashObj&&me.flashObj.flashInit){clearInterval(me.flashInterval);me.flashFuze.fire()}},100)}},openBox:function(method,args,options){var me=this,curPath=location.pathname;options=typeof options=="undefined"?{}:typeof options=="string"?{moduleName:options}:options;options.moduleName=options.moduleName?curPath+"||"+options.moduleName:"";var _method=method?methodNameForShort+"="+method:"",_args=args?"&"+argsValueForShort+"="+encode(args):"",_options=options.moduleName?optionValue+"="+options.moduleName:"",_refer=options.fr?"fr="+options.fr:"",_linkSign=_method||_args||_options?"?":"";var url=[];if(checkFlash){url.push(boxserver);url.push(path)}else{url.push(pageserver);url.push(bridgePath)}if(_linkSign){url.push(_linkSign);url.push(_method+_args);url.push(_method+_args&&_options?"&":"");url.push(_options);url.push(_method+_args&&_refer?"&":"");url.push(_refer)}url=url.join("");if(checkFlash){if(this.flashObj){if(this.flashObj.isExist&&!this.flashObj.isExist(connectName)){window.open(url,connectName)}else{this.flashFuze(function(){me.flashObj.sendMessage(connectName,[method,encode(args),options])})}}}else{try{window.open(url,bridgeName)}catch(e){}}},initBridgePage:function(){if(window.top===window.self){location.href=boxserver+path+getArgs()}else{window.name=bridgeName;if(getArgs()){var url=boxserver+proxyPath+getArgs()+"&__r=naga_201305171538";$('<iframe src="'+url+'" style="display:none"></ifame>').appendTo("body")}}},initProxyPage:function(){var srh=getArgsJSON();var method=srh[methodNameForShort]||srh[methodName],args=srh[argsValueForShort]||srh[argsValue],opt=srh[optionValue],fr=srh[frValue];if(validatorArgs(method+args+opt+fr)){try{args=decodeURIComponent(args).replace(/(_{2,})/g,"_");var m=methodJson[method],opts={moduleName:opt,fr:fr};top.top.mboxCtrl[m](args,opts)}catch(e){}}},initSinglePage:function(){if(checkFlash){window[slcMessageAccess]=function(data){var _args=data&&data[0];var method=_args[0],args=_args[1]||"",opt=_args[2]||"";if(validatorArgs(method+args+opt)){try{args=decodeURIComponent(args).replace(/(_{2,})/g,"_");mboxCtrl[methodJson[method]](args,opt)}catch(e){}}};var me=this;this.flashFuze(function(){me.flashObj.connectServers(connectName,slcMessageAccess);$(window).on("beforeunload",function(){me.flashObj.closeServers()});$(window).on("unload",function(){me.flashObj.closeServers()})})}else{window.name=singleName;var url=pageserver+bridgePath+"?__r=naga_201305171538";$('<iframe src="'+url+'" style="display:none"></iframe>').attr("name","bridgeName").appendTo("body")}if(getLoaded()&&getArgs()){var srh=getArgsJSON(),method=srh[methodNameForShort]||srh[methodName],args=srh[argsValueForShort]||srh[argsValue],opt=srh[optionValue],fr=srh[frValue];if(validatorArgs(method+args+opt+fr)){if(method){this.hasCommandByUrl=true;setLoaded()}try{args=decodeURIComponent(args).replace(/(_{2,})/g,"_");mboxCtrl[methodJson[method]](args,{moduleName:opt,fr:fr})}catch(e){}}}},encode:function(str){return encode(str)},hasCommand:function(){return this.hasCommandByUrl}};return fn}(window);