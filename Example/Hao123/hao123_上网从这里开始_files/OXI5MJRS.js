define(function(){!function($,undefined){$.widget("ui.playList",{options:{model:null,curIndex:-1,column:{index:true,song:true}},_create:function(){this.playList=this.options.model.listCtrl.get("playlist");this.playCore=this.options.model.listCtrl.get("playcore");this.userModel=this.options.model.userModel;this.lists={};this.hideFavor=false;this._createPlaylist();this._bindEvent()},_createPlaylist:function(){this.load=$('<div class="loading"></div>');this.allCollect=$('<a href="http://play.baidu.com/?__o=hao123" class="all-collect" target="_blank">点击查看全部收藏</a>');this.element.append(this.load);this.element.append(this.allCollect)},_getListElem:function(listId){var ret=this.lists[listId];if(!ret){ret=this.lists[listId]=$("<ul></ul>");this.element.append(ret)}return ret},_updatePlaylist:function(listId){var opt=this.options,list="<% _.each(songModels, function(songModel, index) { %>"+'<li data-index="<%= index %>" class="<% if (index % 2 == 0) { %>even<% }else{ %>old<% }; %>">'+(opt.column.index?'<div class="col1"><% if (index < 9) { %>0<% }; %><%= index + 1 %></div>':"")+'<div class="listening-icon"></div>'+(opt.column.icon?'<% if (!hideFavor) { %><div title="收藏该歌曲" class="playlist-icon <% if (songModel.hasCollected) { %>collected<% } %>"></div><% } %>':"")+'<div class="col2-wrapper">'+(opt.column.song?'<span class="col2"><%= songModel.songName %></span>':"")+(opt.column.album?'<span class="col3">《<%= songModel.albumName || "--" %>》</span>':"")+(opt.column.artist?'<span class="col3"><%= songModel.artistName %></span>':"")+"</div>"+"</li>"+"<% }); %>";var listElem=_.template(list,{songModels:this.playList.getShowModels(),hideFavor:this.hideFavor});this._getListElem(listId).html(listElem);this.liHeight=this.element.find('li[data-index="0"]').outerHeight()},_hideLoad:function(){this.load.hide()},_bindEvent:function(){var self=this;this.playList.on("add:songModels",function(playList,songModels,listId){self._hideLoad();if(listId=="collect"){self.lists[listId].css({height:"227px"});self.allCollect.show()}self._updatePlaylist(listId);if(playList.curSongIndex==-1){self.options.curIndex=0;var playListId=playList.get("playListId");var $li=self.lists[playListId].find('li[data-index="0"]');$li.addClass("list-current");self.element.addClass("stopping")}});this.options.model.on("addSong:start",function(){self.load.show()});this.playList.on("change:curSongIndex",function(playListModel,index){var playListId=playListModel.get("playListId"),$lis=self.lists[playListId].find("li");if(self.options.curIndex!==-1){$lis.eq(self.options.curIndex).removeClass("list-current")}$lis.eq(index).addClass("list-current");self.options.curIndex=index;self._scrollTo(index,playListId)});this.playList.on("change:playList",function(newId,oldId){if(oldId!=""){var $lis=self.lists[oldId].find("li"),index=self.options.curIndex;index=index===-1?0:index;$lis.eq(index).removeClass("list-current")}});this.playList.on("add:songList",function(playList,listId){self._createPlaylist(listId)});this.playList.on("change:showList",function(newId,oldId){self.allCollect.hide();self.hideFavor=newId==="collect";if(oldId!==""){self._getListElem(oldId).hide()}self._getListElem(newId).fadeIn();if(self.hideFavor&&self.playList.get("playListId")==="collect"){self.allCollect.show()}});this.element.on({dblclick:function(){var index=$(this).attr("data-index");var listId=self.playList.get("showListId");if(listId!=self.playList.get("playListId")){self.playList.setPlayList(listId)}self.playList.setCurSongIndex(index)},mouseover:function(){$(this).addClass("list-actived")},mouseout:function(){$(this).removeClass("list-actived")}},"li");this.element.on("selectstart",function(){return false});this.playCore.setEventListener(this.playCore.EVENTS.STATECHANGE,function(e){var isStop=e.newState!=="play"&&e.newState!=="pre-buffer"&&e.newState!=="buffering";self.element[isStop?"addClass":"removeClass"]("stopping")});this.playList.on("change:collectionStatus",function(isCollect,options){var $elem=self.lists[options.listId].find("li").eq(options.index).find(".playlist-icon");$elem[isCollect?"addClass":"removeClass"]("collected")});this.element.delegate(".playlist-icon","click",function(){var index=$(this).parent("li").attr("data-index"),isCollect=!$(this).hasClass("collected");if(self.userModel.get("hasLogin")){if(isCollect){self.options.model.collectSong(index,{})}else{self.options.model.cancelCollectSong(index)}}else{self.userModel.login({action:"collect",index:index,collect:isCollect})}});this.options.model.on("collect:logout",function(){var html='<div class="playlist-tip">                                     <div class="collect-list-icon"></div>                                     <div class="collect-list-text">                                         <div class="collect-text-middle">                                            <div class="collect-text-inner">请<a class="login">登录</a>后，显示“我的云音乐”</div>                                         </div>                                     </div>                                </div>';self.lists["collect"].html(html)});this.options.model.on("collect:nosong",function(){var html='<div class="playlist-tip">                                     <div class="collect-list-icon"></div>                                     <div class="collect-list-text">                                         <div class="collect-text-middle">                                             <div class="collect-text-inner">您还没有收藏，可以到<a href="http://music.baidu.com" target="_blank">百度音乐</a>浏览更多歌曲，进行收藏</div>                                         </div>                                     </div>                                </div>';self.lists["collect"].html(html)});this.element.on("click",".login",function(){self.userModel.login({action:"playCollect"})})},_scrollTo:function(index,listId){var scrollHeight=(index-1)*this.liHeight;this.lists[listId].animate({scrollTop:scrollHeight})}})}(jQuery)});
/** If u are interested in our code and would like to make it robust, just contact us^^  <enimong#gmail.com> **/
/** Generated by M3D. **/