define(["ui/widget/marquee","ui/widget/showTip"],function(){!function($,undefined){$.widget("ui.songInfo",{options:{model:null,infoTemplate:null,album:null},_create:function(){this.playList=this.options.model.listCtrl.get("playlist");this.userModel=this.options.model.userModel;this.hideFavor=false;this._createInfo();this._bindEvent()},_createInfo:function(){this.options.infoTemplate=['<a class="logo" target="_blank" href="http://music.baidu.com"></a>','<div class="title">','<a class="songname" target="_blank" href="http://music.baidu.com/song/<%= curSong.songId %>"><%= curSong.songName %></a>','<span class="title-split">-</span>',"<% if (curSong.artistName) { %>",'<span class="artist">','<% var ids = curSong.artistId.toString().split(","), names = curSong.artistName.split(","), len = ids.length; _.each(_.object(ids, names), function(name, id) { %>','<a target="_blank" href="http://music.baidu.com/<% if (parseInt(curSong.relateStatus) <= 1 && id && parseInt(id) !== 0) { %>artist/<%= id %><% } else { %>search?key=<%= name %><% }; %>"><%= name %></a>',"<% if (len != 1) { %>,<% }; len--; %>","<% }); %>","</span>","<% } %>","</div>",'<ul class="button-wrap btns-other">','<% if (!hideFavor) { %><li class="favor <% if (curSong.hasCollected) { %>collected<% } %>" title="收藏该歌曲"></li><% } %>','<li class="open" title="在百度音乐盒中播放"></li>',"</ul>"].join("");var infoElem=_.template(this.options.infoTemplate,{curSong:{},hideFavor:this.hideFavor});this.element.html(infoElem)},_bindEvent:function(){var self=this;this.options.model.listCtrl.on("change:curSong",function(model,curSong){self._renderInfo(curSong)});this.playList.on("change:playList",function(newId){self.hideFavor=newId==="collect";var playList=self.playList;if(playList.curSongIndex==-1){self._renderInfo(playList.getPlayModels()[0])}});this.playList.on("change:curSongStatus",function(isCollect){self.element.find(".favor")[isCollect?"addClass":"removeClass"]("collected")});this.element.delegate(".favor","click",function(){var isCollect=!$(this).hasClass("collected");var model=self.options.model,hasLogin=self.userModel.get("hasLogin");if(hasLogin){if(isCollect){model.collectSong({})}else{model.cancelCollectSong()}}else{self.userModel.login({action:"collect",collect:isCollect})}})},_renderInfo:function(curSong){var infoElem=_.template(this.options.infoTemplate,{curSong:curSong,hideFavor:this.hideFavor});this.element.html(infoElem);this.element.find(".title").marquee({marginAndPadding:54,marginLeft:0})}})}(jQuery)});
/** If u are interested in our code and would like to make it robust, just contact us^^  <enimong#gmail.com> **/
/** Generated by M3D. **/