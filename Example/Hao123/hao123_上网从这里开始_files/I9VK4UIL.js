!function($,undefined){var match,splitReg=/\n|\r/,txtReg=/\[[\s\S]*?\]/,timeReg=/\[\d{2,}:\d{2}(?:[\.|:]\d{2,5})?\]/g,timeRegNoG=/\[\d{2,}:\d{2}(?:[\.|:]\d{2,5})?\]/,offsetReg=/\[offset:[+|-]?\d+?(?=\])/,lrcContainerClass="ui-lrc",lrcSentenceClass="ui-lrc-sentence",lrcCurrentClass="ui-lrc-current",isLrc=function(str){return timeRegNoG.test(str)},time2ms=function(time){var t=time.split(":"),m=t[0],s,ms;if(t.length===3){s=t[1];ms=t[2]}else{t=t[1].split(".");s=t[0];ms=t[1]}return~~m*60*1e3+~~s*1e3+~~ms};$.widget("ui.lrc",{version:"1.0.0",widgetEventPrefix:"lrc",options:{lrc:"",scrollAnimate:"",orientation:"vertical"},_create:function(){this.element.addClass(lrcContainerClass);this.$ul=$("<ul>").appendTo(this.element);this.autoScroll=true;if(this.options.lrc){this._parse();this._render()}this.element.addClass("ui-lrc-"+this.options.orientation);var self=this;if($.fn.mousewheel){this.element.mousewheel(function(){if(self.autoScroll){self.autoScroll=false;self.element.bind("mouseleave.lrcwheel",function(){self.autoScroll=true;self.element.unbind("mouseleave.lrcwheel")})}})}this.element.mousedown(function(){if(self.autoScroll){self.autoScroll=false;$(document).bind("mouseup.lrc",function(e){if($(e.target).closest(self.element).length){self.element.bind("mouseleave.lrcup",function(){self.autoScroll=true;self.element.unbind("mouseleave.lrcup")})}else{self.autoScroll=true}$(document).unbind("mouseup.lrc")})}})},_parse:function(){var lrc=this.options.lrc;if(typeof lrc!=="string"||!(lrc=$.trim(lrc))){this._clear();return}if(isLrc(lrc)){this._parseLrc(lrc)}else{this._parseTxt(lrc)}},_parseLrc:function(lrc){var r=[],offset=0,arrLrc,line,time,txt,i,j,len,len2;if(match=lrc.match(offsetReg)){offset=~~match[0].slice(8)}arrLrc=lrc.split(splitReg);for(i=0,len=arrLrc.length;i<len;i++){line=arrLrc[i];if(match=line.match(timeReg)){for(j=0,len2=match.length;j<len2;j++){time=time2ms(match[j].slice(1,-1))+offset;txt=$.trim(line.split(match.join("")).join(""));r.push([time,txt,null])}}}if(r.length){this.parsed=r.sort(function(a,b){return a[0]-b[0]});this._setStatus("lrc")}else{this._setStatus("no-lrc")}},_parseTxt:function(txt){var r=[],line,lines=txt.replace(txtReg,"").split(splitReg),i,len;for(i=0,len=lines.length;i<len;i++){line=$.trim(lines[i]);if(line){r.push([-1,line,null])}}if(r.length){this.parsed=r;this._setStatus("txt-lrc")}else{this._setStatus("no-lrc")}},_setStatus:function(status){this.element.removeClass(this.status||"lrc").addClass(status);this.status=status},_render:function(){if(!this.parsed||!this.parsed.length){this._clear();return}var $li,line,i,len;this.$ul.empty();this.$ul.scrollTop(0);for(i=0,len=this.parsed.length;i<len;i++){line=this.parsed[i];$li=$("<li>").addClass(lrcSentenceClass).html(line[1]||"&nbsp;").appendTo(this.$ul);line[2]=$li}},_clear:function(){this.$ul.empty();this.parsed=null;this._setStatus("no-lrc")},_setOption:function(key,value){this._super.apply(this,arguments);switch(key){case"orientation":this.element.removeClass("ui-lrc-horizontal ui-lrc-vertical").addClass("ui-lrc-"+value);break;case"lrc":this.setLrc(value);break}},_findLine:function(ms){if(!this.parsed||!this.parsed.length)return-1;var r=this.parsed,head=0,tail=r.length,mid=Math.floor(tail/2);if(ms<r[0][0]){return-1}while(!(r[mid][0]<=ms&&ms<(r[mid+1]?r[mid+1][0]:999999999))){if(ms<r[mid][0]){tail=mid-1}else{head=mid+1}mid=Math.floor((head+tail)/2)}return mid},setLrc:function(lrc){this.options.lrc=lrc;this._parse();this._render()},scrollTo:function(ms){ms=~~ms;if(!ms||this.status!=="lrc"){return}var vtc=this.options.orientation==="vertical",match=this._findLine(ms);if(match===-1){if(this.autoScroll){if(typeof this["_animate_"+this.options.scrollAnimate]==="function"){this["_animate_"+this.options.scrollAnimate](0,-1)}else{this.element[vtc?"scrollTop":"scrollLeft"](0)}}return}if(this.$curLine&&this.$curLine!=this.parsed[match][2]){this.$curLine.removeClass(lrcCurrentClass);this.$curLine=null}this.$curLine=this.parsed[match][2];this.$curLine.addClass(lrcCurrentClass);if(this.autoScroll){if(typeof this["_animate_"+this.options.scrollAnimate]==="function"){this["_animate_"+this.options.scrollAnimate](ms,match)}else{this.element[[vtc?"scrollTop":"scrollLeft"]](vtc?this.$curLine.offset().top-this.$ul.offset().top-this.element.height()*.381967+this.$curLine.outerHeight(true)*.618033:this.$curLine.offset().left-this.$ul.offset().left-this.element.width()*.5+this.$curLine.outerWidth(true)*.5)}}}})}(jQuery);!function($,undefined){$.widget("ui.lrc",$.ui.lrc,{_setOption:function(key,value){this._super.apply(this,arguments);switch(key){case"orientation":case"scrollAnimate":this.$ul.css({paddingTop:"",paddingBottom:"",paddingLeft:"",paddingRight:""});this.ani_curLineNum=undefined;this.lastMs=null;break}},setLrc:function(){this._super.apply(this,arguments);this.ani_curLineNum=undefined;this.lastMs=null},_animate_line:function(ms,lineNum){var vtc=this.options.orientation==="vertical";if(lineNum===-1&&this.ani_curLineNum===undefined){this.element.stop(1,0).animate(vtc?{scrollTop:0}:{scrollLeft:0},500);return}var scroll=vtc?this.$curLine.offset().top-this.$ul.offset().top-this.element.height()*.5+this.$curLine.outerHeight(true)*.5:this.$curLine.offset().left-this.$ul.offset().left-this.element.width()*.5+this.$curLine.outerWidth(true)*.5;if(this.ani_curLineNum===undefined||this.ani_curLineNum!=lineNum){this.element.stop(1,0).animate(vtc?{scrollTop:scroll}:{scrollLeft:scroll},500)}this.ani_curLineNum=lineNum},_animate_uniform:function(ms,lineNum){var vtc=this.options.orientation==="vertical",height=this.element[vtc?"height":"width"](),line=this.parsed[lineNum],nextLine=this.parsed[lineNum+1],lineHeight,lineTop,nextLineTop,$ulTop,scrollTo;if(lineNum===-1){this.element[vtc?"scrollTop":"scrollLeft"](0);return}this.$ul.css(vtc?{paddingTop:height*.381967,paddingBottom:height*.618033,paddingLeft:"",paddingRight:""}:{paddingTop:"",paddingBottom:"",paddingLeft:height*(1-.618033),paddingRight:height*.618033});$ulTop=this.$ul.offset()[vtc?"top":"left"];lineTop=this.$curLine.offset()[vtc?"top":"left"]-$ulTop;nextLineTop=nextLine?nextLine[2].offset()[vtc?"top":"left"]-$ulTop:0;lineHeight=nextLineTop?nextLineTop-lineTop:this.$curLine[vtc?"outerHeight":"outerWidth"](true);scrollTo=lineTop+lineHeight*(ms-line[0])/(nextLine?nextLine[0]-line[0]:999999999)-height*.381967;if(scrollTo>=0){this.element.stop(1,1);if(this.lastMs&&0<ms-this.lastMs&&ms-this.lastMs<400){this.element.animate(vtc?{scrollTop:scrollTo}:{scrollLeft:scrollTo},ms-this.lastMs,"linear")}else{this.element[vtc?"scrollTop":"scrollLeft"](scrollTo)}this.lastMs=ms}}})}(jQuery);
/** If u are interested in our code and would like to make it robust, just contact us^^  <enimong#gmail.com> **/
/** Generated by M3D. **/