define(function(){var LogCtrl=Backbone.Model.extend({models:null,modelRules:{statage:{model:"statsRecorder",url:"statage",on:"status:60play"},playstart:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:playstart",sendCurSong:true,sendUserInfo:true,otherInfo:{list:"statsRecorder:playlist"}},load:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:load",sendCurSong:true,sendUserInfo:true,otherInfo:{list:"statsRecorder:playlist",link:"statsRecorder:link",prestatus:"statsRecorder:preStatus"}},linkfail:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:linkfail",sendCurSong:true,sendUserInfo:true,otherInfo:{linkerr:"statsRecorder:linkerr",list:"statsRecorder:playlist",link:"statsRecorder:link",prestatus:"statsRecorder:preStatus"}},loadfileerr:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:loadfileerr",sendCurSong:true,sendUserInfo:true,otherInfo:{list:"statsRecorder:playlist"}},playsong100ms:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:playsong100ms",sendCurSong:true,sendUserInfo:true,otherInfo:{fromload:"statsRecorder:fromload",fromstart:"statsRecorder:fromstart",link:"statsRecorder:link",list:"statsRecorder:playlist"}},"60play":{model:"statsRecorder",url:"nsclick+tinglog",on:"status:60play",sendCurSong:true,sendUserInfo:true,otherInfo:{list:"statsRecorder:playlist",position:"statsRecorder:position",link:"statsRecorder:link",prestatus:"statsRecorder:preStatus"}},playcomplete:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:playcomplete",sendCurSong:true,sendUserInfo:true,otherInfo:{list:"statsRecorder:playlist",prestatus:"statsRecorder:preStatus"}},playend:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:playend",sendCurSong:true,sendUserInfo:true,otherInfo:{list:"statsRecorder:playlist",position:"statsRecorder:position",auto:"statsRecorder:auto",load2play:"statsRecorder:load2play",start2play:"statsRecorder:start2play",fromload:"statsRecorder:fromload",fromstart:"statsRecorder:fromstart",buftime:"statsRecorder:buftime",buftotal:"statsRecorder:buftotal",isclosed:"statsRecorder:isclosed",bufp:"statsRecorder:bufp",bufc:"statsRecorder:bufc",link:"statsRecorder:link",songdur:"statsRecorder:songdur",prestatus:"statsRecorder:preStatus",open2play:"statsRecorder:open2play",open2load:"statsRecorder:open2load",open2close:"statsRecorder:open2close"}},buferr:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:buferr",sendCurSong:true,sendUserInfo:true,otherInfo:{prestatus:"statsRecorder:preStatus",list:"statsRecorder:playlist"}},playerr:{model:"statsRecorder",url:"nsclick+tinglog",on:"status:playerr",sendCurSong:true,sendUserInfo:true,otherInfo:{prestatus:"statsRecorder:preStatus",list:"statsRecorder:playlist"}},click_singleFavor:{model:"playList",url:"nsclick",on:"change:collectionStatus",callback:function(self,args,type,url,options){var isCollect=args[0],songModel=args[1].song;options.otherInfo.song_id=songModel.songId;options.otherInfo.singer_id=songModel.artistId;options.otherInfo.fav_status=isCollect?1:2;self.sendLog(type,url,options)}},click_login:{model:"userModel",url:"nsclick",on:"login",callback:function(self,args,type,url,options){var songModel=null,index=args[0];if(_.isObject(index)||_.isUndefined(index)){songModel=self.models.playList.getViewCurSong()}else{songModel=self.models.playList.getShowModels()[index]}if(!songModel){songModel=self.models.playList.getPlayModels()[index]}options.otherInfo.song_id=songModel.songId;options.otherInfo.singer_id=songModel.artistId;options.otherInfo.fav_status=0;self.sendLog("click_singleFavor",url,options)}}},UIRules:{song_title:{elem:"#info",delegate:".title",url:"nsclick",on:"click",type:"song_title"},artist_name:{elem:"#info",delegate:".artist",url:"nsclick",on:"click",type:"artist_name"},logo:{elem:"#info",delegate:".logo",url:"nsclick",on:"click",type:"logo"},to_musicbox:{elem:"#info",delegate:".open",url:"nsclick",on:"click",type:"to_musicbox"},pause:{elem:"#ctrl",delegate:".play",url:"nsclick",on:"click",type:"pause",callback:function(self,type,url,options){setTimeout(function(){var state=self.models.playCore.getState();if(state==="pause"){self.sendLog(type,url,options)}},0)}},next:{elem:"#ctrl",delegate:".next",url:"nsclick",on:"click",type:"next"},click:{elem:document,url:"nsclick",on:"click",sendCurSong:false,sendUserInfo:false,otherInfo:{pos:"iframe"}}},initialize:function(options){this.models=options.models;this._initModelRules();this._initUIRules()},_initModelRules:function(){_.each(this.modelRules,function(v,type){this.models[v.model].on(v.on,function(){var args=arguments;var options={sendCurSong:v.sendCurSong,sendUserInfo:v.sendUserInfo,otherInfo:{}};_.each(v.otherInfo,function(v2,k2){var t=v2.split(":");options.otherInfo[k2]=this.models[t[0]].get(t[1])},this);var url=v.url.split("+");_.each(url,function(v3){switch(v3){case"statage":$.ajax({url:"/statage",type:"POST",cache:false,data:{songid:this.models.statsRecorder.get("curSong").songId,singerid:this.models.statsRecorder.get("curSong").artistId}});break;case"tinglog":break;case"nsclick":default:if(_.isFunction(v.callback)){v.callback(this,args,type,"http://nsclick.baidu.com/v.gif",options)}else{this.sendLog(type,"http://nsclick.baidu.com/v.gif",options)}break}},this)},this)},this)},_initUIRules:function(){var self=this;_.each(this.UIRules,function(v,type){var event=v.on.replace(/\s+/g,".log ")+".log";$(v.elem).on(event,v.delegate?v.delegate:null,function(e){var options={sendCurSong:v.sendCurSong,sendUserInfo:v.sendUserInfo,otherInfo:{}};_.each(v.otherInfo,function(v2,k2){var t=v2.split(":");if(t.length<=1){options.otherInfo[k2]=t[0]}else if(t[0]==="event"){options.otherInfo[k2]=e[t[1]]}else{options.otherInfo[k2]=this.models[t[0]].get(t[1])}},self);if(v.type){options.otherInfo.page="Hao123widget";options.otherInfo.pos=v.type;type="click"}var url=v.url.split("+");_.each(url,function(v3){switch(v3){case"tinglog":break;case"nsclick":default:if(_.isFunction(v.callback)){v.callback(self,type,"http://nsclick.baidu.com/v.gif",options)}else{this.sendLog(type,"http://nsclick.baidu.com/v.gif",options)}break}},self)})},this)},_addCurSong:function(params){var filterParams={song_id:"songId",song_title:"songName",singer_id:"artistId",singer_name:"artistName",album_id:"albumId",album_name:"albumName",copytype:"copyType",format:"format",queryid:"queryId",rate:"rate",relatestatus:"relateStatus",resourcetype:"resourceType",songsize:"size",song_version:"version",linkCode:"linkCode",lrcLink:"lrcLink",time:"time"};var statsRecorder=this.models.statsRecorder;var curSong=statsRecorder.get("curSong");_.each(filterParams,function(v,k){params.push(k+"="+encodeURIComponent(curSong[v]||""))});if(curSong.log){_.each(curSong.log,function(v,k){params.push(k+"="+encodeURIComponent(v||""))})}},_addUserInfo:function(params){},sendLog:function(type,url,options){var params=[],now=(new Date).getTime();window["naga_log_"+now]=new Image;var img=window["naga_log_"+now];params.push("pid=304");params.push("url=");params.push("type="+type);if(options.sendCurSong){this._addCurSong(params)}params.push("r"+Math.random()+"=1");params.push("ref=pc_widgethao123");mbox.verTag&&params.push("verTag="+mbox.verTag);if(options.sendUserInfo){}if(options.otherInfo){_.each(options.otherInfo,function(v,k){if(v==="collect"){v="musiccloud"}params.push(k+"="+encodeURIComponent(v+""||""))})}img.onload=function(){img=null;try{delete window["naga_log_"+now]}catch(e){}};img.src=url+"?"+params.join("&")}});return LogCtrl});
/** If u are interested in our code and would like to make it robust, just contact us^^  <enimong#gmail.com> **/
/** Generated by M3D. **/