function Tabs(e,t){this.currentTab=e,this.tabs={};for(i in mailboxes)this.tabs[mailboxes[i]]=e==mailboxes[i]?new Tab(mailboxes[i],counts[mailboxes[i]],t):new Tab(mailboxes[i],counts[mailboxes[i]],0)}function createHash(e){log("Inside createHash-stateArg.messageId:"+e.messageId);var t,a=[];a.push(e.mailbox);for(i in mailboxes)t=e.mailbox==mailboxes[i]?e:tabs.getTabObject(mailboxes[i]).getState(),a.push(t.count),a.push(t.page),a.push(t.messageId),a.push(t.sortby);return a.join("_")}function parseHash(e){var t=e.split("_");if(t.length!=1+4*mailboxes.length)return alert(getLang("Incorrect http address.")),void 0;var a={};a.currentTab=t[0];var s=1;for(i in mailboxes)a[mailboxes[i]]={},a[mailboxes[i]].mailbox=mailboxes[i],a[mailboxes[i]].count=parseInt(t[s++]),a[mailboxes[i]].page=parseInt(t[s++]),a[mailboxes[i]].messageId=parseInt(t[s++]),a[mailboxes[i]].sortby=parseInt(t[s++]);return a}function pageLoad(e){if(void 0!=e&&""!=e||""==initial_hash||(e=initial_hash,log("default hash:"+e)),e){log(e);var t=parseHash(e);for(i in mailboxes)t.currentTab==mailboxes[i]?tabs.setCurrentTab(t[mailboxes[i]]):tabs.getTabObject(mailboxes[i]).setState(t[mailboxes[i]])}else log("load initial inbox"),tabs.setCurrentTab()}function Tab(e,t,a){this.pageSize=10,this.pageSizePrivateShowCase=12,this.name=e,this.isDataReady,this.sortedIds=[],this.page=1,this.isDrawingCurrentPage=!1,this.clearDatagrid(),this.currentMessageId=a,this.setCount(t);var i=this;this.getSortSelectionBox().change(function(){i.clearDatagrid();var e=i.getState();e.page=1,log("load sort change"),$.historyLoad(createHash(e))});var s=this.getCheckAll();s.click(function(){i.getCheckboxes().attr("checked",s.is(":checked"))}),$("#"+this.name+"ActionBar .deleteSelectedButton").click(function(){if(i.getChecked().length>1)var e="Are you sure you would like to delete these messages?";else var e="Are you sure you would like to delete this message?";if(confirm(getLang(e))){var t={},a=[];i.getChecked().each(function(){a.push($(this).attr("id"))}),a=a.join("|"),t.method="deleteMessage",t.ids=a,t.mailbox=i.name,$.post(ajax_url,t,function(e){e.success?i.deleteMessages(e.ids):i.error(getLang(e.reason))},"json")}});var o=$("#"+this.name+"ActionBar .hideReadOption").show();o.click(function(){var e;o.hasClass("checked")?(o.removeAttr("checked"),o.removeClass("checked"),e=0):(o.attr("checked",!0),o.addClass("checked"),e=1);var t={};t.method="readMessageHideToggle",t.showReadMessageSetting=e,$.post(ajax_url,t,function(e){e.success&&(window.location="/app/private/member/message/inbox.p?mailbox="+i.name)},"json")}),$("#"+this.name+"PrivateKeyRequest .acceptAllButton").click(function(){var e={};e.method="acceptAllRequests",$.post(ajax_url,e,function(e){e.success?(showNote(getLang("Successfully granted access to all requests.")),$(".privateKeyRequestContainer").hide()):i.error(getLang(e.reason))},"json")})}function Datagrid(e,t){this.data=e,this.mailbox=t;var a=new Date;"travelingman"==t?this.warn_time_travelingman=a.getTime()/1e3-3600*24*warn_travelingman_delete:this.warn_time=a.getTime()/1e3-3600*24*warn_auto_delete}function log(e){debug&&$("<div style='color:red'>").html(e).appendTo("#log")}function scaleInboxImage(e){0==$(e.pID).width()||0==$(e.pID).height()?$(e.pID).load(function(){_scaleInboxImage(e)}):_scaleInboxImage(e)}function scaleInboxImageOnLoad(e){$(e.pID).load(function(){_scaleInboxImage(e)})}function _scaleInboxImage(e){var t={pID:"",maxwidth:50,maxheight:40},e=$.extend(t,e);if(""!=e.pID){var a=$(e.pID),i=a.width(),s=a.height(),o=0,n=0,r=0;i>e.maxwidth&&(o=s/i,n=e.maxwidth,r=n*o,r>e.maxheight&&(o=n/r,r=e.maxheight,n=r*o)),e.maxwidth>=i&&s>e.maxheight&&(o=i/s,r=e.maxheight,n=r*o),log("width:"+i+"----height:"+s+"maxwidth:"+e.maxwidth+"----maxheight:"+e.maxheight+"new_width:"+n+"----new_height:"+r),n&&a.height(r).width(n)}}function showLoading(e){0==$("#loadingDiv").length?$("BODY").append('<DIV id="loadingDiv"><img src="'+img_base_url+'v2/private/messages/loadingimg.gif" align="left"><span></span></DIV>'):$("#loadingDiv").html('<img src="'+img_base_url+'v2/private/messages/loadingimg.gif" align="left"><span></span>');var t=$("#loadingDiv");return t.css("position","absolute"),t.css("top",($(window).height()-t.height())/2+$(window).scrollTop()+"px"),t.css("left",($(window).width()-t.width())/2+$(window).scrollLeft()+"px"),void 0!=e&&(t.find("span").html(e),t.fadeIn()),this}function hideLoading(e){var t=$("#loadingDiv");return void 0==e?t.remove():(t.html("<span>"+e+"</span>").show(),setTimeout("$('#loadingDiv').fadeOut(500);",1500),setTimeout("$('#loadingDiv').remove();",2e3)),this}function showNote(e){0==$(".note").length&&$("#messageCenter").parent().prepend('<DIV class="note"></DIV>');var t=$(".note").show();t.html(e+'<img src="'+img_base_url+'v2/private/settings/btn_note_close.gif" class="noteclose">'),$(".noteclose").unbind("click").bind("click",function(){t.hide()})}function hideNote(){$(".note").hide()}function drawPhotoRow(){var e=tabs.getTabObject("inbox").getCount(),t=tabs.getTabObject("inbox").getSortby();if(5>e&&"default"==t){var a={};a.method="getMemberPhotos";var i=$("#photoRow");i.find("table tr").remove(),$.post(ajax_url,a,function(e){if(e.success){var t=[];$.each(e.members,function(e,a){var i=profile_base_url+e+"&source=inboxSearch";""!=a.photo_url&&(a.photo_url=a.photo_url.replace("http:","https:")),t.push('<td valign="bottom" align="center"><a href="'+i+'"><img alt="'+getLang("Click For Profile Details")+'" title="'+getLang("Click For Profile Details")+'" border="0" src="'+a.photo_url+'"></a><br/><a class="messageLink" href="'+i+'">'+a.nickname+", "+a.city+"</a></td>")}),i.find("table").html("<tr>"+t.join("")+"</tr>"),i.show(),scalePhotos($("#photoRow table tr img"))}},"json")}}function scalePhotos(e){e.each(function(){scaleInboxImageOnLoad({pID:this,maxwidth:100,maxheight:80})})}function bindListeners(){$(".photoFrame .big").hover(function(){$(this).children(".overlay-wrapper-close").fadeIn(100),$(this).children(".overlay-wrapper").fadeIn(100)},function(){$(this).children(".overlay-wrapper-close").fadeOut(100),$(this).children(".overlay-wrapper").fadeOut(100)})}function bindLightBoxListener(e){e.lightBox({overlayOpacity:.3,containerResizeSpeed:100,imageLoading:profile_img_base_url+"v3/private/shared/lightbox/images/lightbox-ico-loading.gif",imageBtnClose:profile_img_base_url+"v3/private/shared/lightbox/images/lightbox-btn-close.gif",imageBtnPrev:profile_img_base_url+"v3/private/shared/lightbox/images/lightbox-btn-prev.gif",imageBtnNext:profile_img_base_url+"v3/private/shared/lightbox/images/lightbox-btn-next.gif",txtImage:"",txtOf:" / "})}function updateViewRatedPhotoRule(e){var t={};t.method="updateRatedPhotoView",t.viewOption=e,showLoading(getLang("Processing...")),$.post(ajax_url,t,function(e){hideLoading(),e.success?window.location.reload():alert(getLang("Failed to enable/disable viewing rated photos. Please try again later."))},"json")}var warn_auto_delete=18,warn_travelingman_delete=80,debug=!1,isScrollTop=!0,mailboxes=["inbox","photo","wink","saved","sent","travelingman"],tabs,inbox_url,ajax_url,profile_base_url,showcase_base_url,contact_base_url,settings_url,male_nophoto_url,female_nophoto_url,collect_icon_url,key_icon_url,gift_icon_url,priority_icon_url,replied_icon_url,subscription_modal_url,nickname;$.ajaxSetup({beforeSend:function(e){e.overrideMimeType&&e.overrideMimeType("text/html; charset="+message_center_charset)}}),$(document).ready(function(){inbox_url="/app/private/member/message/inbox.p?",ajax_url="/app/private/member/message/messageajax.p?",profile_base_url="/app/private/member/profile.p?id=",showcase_base_url="/app/private/member/showcase.p?id=",contact_base_url="/app/private/member/contact/contact.p?",settings_url="/app/private/member/settings/contact.p?",payment_url="/app/private/member/payment/optimalcc.p?",message_center_lang=message_center_lang?message_center_lang:"en_US",male_nophoto_url=profile_img_base_url+"v3/private/profile/m_avatar_shush.png",female_nophoto_url=profile_img_base_url+"v3/private/profile/f_avatar_shush.png",subscription_modal_url="/app/private/member/modals/micsubscription/modal.p";var e=img_base_url+"v2/private/messages/";collect_icon_url=e+"icon_inbox_collect.gif",key_icon_url=e+"icon_inbox_privatekey.gif",travelingman_icon_url=e+"icon_inbox_travelingman.gif",gift_icon_url=e+"../chat/icon-gift.gif",priority_icon_url=e+"icon_inbox_priority.gif",replied_icon_url=e+"icon_replied.gif",alert_icon_url=e+"icon_alert.gif",admirer_icon_url=e+"icon_admirer.gif",requested_men_banner_url=e+"profiles_men_tiny.png",tabs=new Tabs(currentMailbox,currentMessageId),log("init load "),$.historyInit(pageLoad),$(".tabbedNav li").each(function(){$(this).click(function(){var e=$(this).attr("id");e!=tabs.getCurrentTab()&&hideNote();var t=tabs.getTabObject(e).getState();t.page=1,t.messageId=0,log("load nav"),$.historyLoad(createHash(t))})}),bindListeners()}),Tabs.prototype.getCurrentTab=function(){return this.currentTab},Tabs.prototype.setCurrentTab=function(e){var t="inbox";if(-1!=document.cookie.indexOf("flirtblaster_once=1")||window.fb){var t="sent";$.cookie("flirtblaster_once","",{path:"/",domain:cookie_domain})}var a={mailbox:t,count:-1,page:1,messageId:0,sortby:0},e=$.extend(a,e);-1==e.count&&(e.count=this.tabs[e.mailbox].getCount()),this.currentTab=e.mailbox;var i=this.tabs[this.currentTab].setState(e);i.sortby!=e.sortby&&"photo"!=this.currentTab&&this.tabs[this.currentTab].clearDatagrid(),this.drawCurrentTab()},Tabs.prototype.getCurrentTabObject=function(){return this.tabs[this.currentTab]},Tabs.prototype.getTabObject=function(e){return this.tabs[e]},Tabs.prototype.drawCurrentTab=function(){this.tabs[this.currentTab].draw()},Tab.prototype.setState=function(e){var t=this.getState();return void 0!=e.count&&this.setCount(e.count),void 0!=e.page&&(this.page=e.page),void 0!=e.messageId&&(this.currentMessageId=e.messageId),void 0!=e.sortby&&this.getSortSelectionBox().val(e.sortby),t},Tab.prototype.getState=function(){var e={};return e.mailbox=this.name,e.count=this.getCount(),e.page=this.page,e.messageId=this.currentMessageId,e.sortby=this.getSortSelectionBox().val(),e},Tab.prototype.getCount=function(){return parseInt($("#"+this.name+" .messageItems").html())},Tab.prototype.setCount=function(e){var t=this.getCount();return $("#"+this.name+" .messageItems").html(e+""),t},Tab.prototype.getPageDataStart=function(e){return(e-1)*this.pageSize},Tab.prototype.resetIsDrawingCurrentPage=function(){this.isDrawingCurrentPage=!1},Tab.prototype.setMessageRange=function(){var e=this.getPageDataStart(this.page)+1,t=e+this.getTRs().length-1;e>t?$("."+this.name+"MessageRange").html(""):$("."+this.name+"MessageRange").html(e+"-"+t)},Tab.prototype.getSortSelectionBox=function(){return $("#"+this.name+"ActionBar select.sortMessages")},Tab.prototype.getTbody=function(){return $("#"+this.name+"Datagrid tbody")},Tab.prototype.getCheckAll=function(){return $("#"+this.name+"Datagrid th .checkAll").show()},Tab.prototype.getTRs=function(){return $("tr",$(this.getTbody())).not(".hideTR")},Tab.prototype.getTR=function(e){return $("#t"+e)},Tab.prototype.getCheckboxes=function(){return $("tr",$(this.getTbody())).not(".hideTR").find("td input[type=checkbox]")},Tab.prototype.getChecked=function(){return $("tr",$(this.getTbody())).not(".hideTR").find("td input[type=checkbox]:checked")},Tab.prototype.getSortby=function(){var e=["default","sender","gift","priority","collect","custom","wink","key","favorite"],t=parseInt(this.getSortSelectionBox().val());return(0>t||t>8)&&(t=0),e[t]},Tab.prototype.draw=function(){$(".current").removeClass("current"),$("#"+this.name).addClass("current"),0!=this.currentMessageId?this.drawMessage():this.drawMailbox()},Tab.prototype.drawPrivateKeyRequest=function(){var e=this,t={};t.method="getPrivateKeyRequestData",showLoading(getLang("Loading Private Key Requests...")),$.post(ajax_url,t,function(t){t.success?e._updatePrivateKeyRequest(t):e.error(getLang("Cannot retrieve private key request .Please try again later.")),hideLoading()},"json")},Tab.prototype._updatePrivateKeyRequest=function(e){if(e.success)if(e.showRequest){$(".requestCount").html(e.count);var t="";if(e.photo.length>0){for(i=0;e.photo.length>i;i++)t=t+'<div class="fromImage" style="float:left; margin-right:0px"><div class="crop"><div><img src="'+e.photo[i]+'" border="0" /></div></div></div>';$(".requestPhoto").html(t)}else"M"==e.requesterGender?$(".requestPhoto").html('<div class="fromImage" style="float:left; margin-right:0px"><div class="crop"><img class="noPhoto" src="'+male_nophoto_url+'"/></div></div>'):$(".requestPhoto").html('<div class="fromImage" style="float:left; margin-right:0px"><div class="crop"><img class="noPhoto" src="'+female_nophoto_url+'"/></div></div>');$(".privateKeyRequestContainer").show()}else $(".privateKeyRequestContainer").hide()},Tab.prototype.drawMailbox=function(){var e=this;if(e._showMailbox(),this.isDataReady)"photo"==e.name?this._redrawPrivateShowcase():this._drawCurrentPage();else{this.drawPrivateKeyRequest();var t={};t.method="getSortedData",t.mailbox=this.name,t.sortby=this.getSortby(),t.offset=0,t.limit=this.pageSize*this.page+Math.ceil(this.pageSize/2),showLoading(getLang("Loading messages...")),$.post(ajax_url,t,function(t){if(t.success){if(1==e.isDataReady)return;if("photo"==e.name)return e.setCount(0),e._initPrivateShowcase(t),e._showPrivateShowcase(t),void 0;e._initDatagrid(t),e._showCurrentPage(!0),"inbox"==e.name&&drawPhotoRow()}else e.error(getLang("Cannot retrieve your messages. Please try again later."));hideLoading()},"json")}},Tab.prototype.drawMessage=function(){var e=this,t={};t.method="getMessage",t.mailbox=this.name,t.id=this.currentMessageId,$.post(ajax_url,t,function(t){t.success?e._drawMessage(t):(e.error(t.reason),e.currentMessageId=0,e.draw())},"json")},Tab.prototype._showMailbox=function(){$("#messageWrapper").hide(),$(".mailboxWrapper").hide(),$("#"+this.name+"Wrapper").show()},Tab.prototype.clearDatagrid=function(){this.isDataReady=!1,this.sortedIds=[],this.getTbody().html("")},Tab.prototype._initDatagrid=function(e){var t=this;this.isDataReady=!0,this.sortedIds=[],$.each(e.ids,function(){t.sortedIds.push(this)}),this.setCount(this.sortedIds.length);var a=new Datagrid(e,this.name);a.appendRows()},Tab.prototype._drawCurrentPage=function(){if(!this.isDrawingCurrentPage){this.isDrawingCurrentPage=!0;var e=this,t=0,a=t+this.pageSize*this.page,s=this._getUndownloadedIds(t,a);if(0==s.length)this._showCurrentPage(),this.resetIsDrawingCurrentPage();else{var o={};o.method="getMessageListByIds",o.mailbox=this.name;var n=this._getUndownloadedIds(a,a+this.pageSize);for(i=0;n.length>i;i++)s.push(n[i]);o.ids=s.join("|"),showLoading(getLang("Loading messages...")),$.post(ajax_url,o,function(t){if(t.success){var a=new Datagrid(t,e.name);a.appendRows(),e._showCurrentPage()}else e.error(getLang("Cannot retrieve your messages. Please try again later."));hideLoading(),e.resetIsDrawingCurrentPage()},"json")}}},Tab.prototype._getUndownloadedIds=function(e,t){var a=this,i=this.sortedIds.slice(e,t),s=[];return $.each(i,function(e,t){0==a.getTR(t).length&&s.push(t)}),s},Tab.prototype._showCurrentPage=function(){var e=this;this.setCount(this.sortedIds.length);var t=e.getState(),a=createHash(t);$.cookie("from_url"+my_pnum,inbox_url+"&hash="+a,{path:"/",domain:cookie_domain});var i=Math.ceil(this.getCount()/this.pageSize);this.page>i&&(this.page=i),log("Last page: "+i+"--getCount: "+this.getCount()+"--page: "+this.page),this._setupPagination(),$("."+this.name+"Prev, ."+this.name+"Next").each(function(){$(this).unbind("click").bind("click",function(){var t=e.getState();t.page=parseInt($(this).attr("name")),log("load pre/next"),$.historyLoad(createHash(t))})}),this.setMessageRange(),this.getTRs().each(function(){scaleInboxImage({pID:$(this).find(".crop IMG")})}),isScrollTop?$("html, body").scrollTop(0):isScrollTop=!0},Tab.prototype._setupPagination=function(){this._showDatagrid(),this._updateCheckAll(),this._updatePrevNextButtons()},Tab.prototype._showDatagrid=function(){var e=this.getPageDataStart(this.page),t=this.getTbody();$("tr",t).removeClass("hideTR").addClass("hideTR"),$("tr",t).slice(e,e+this.pageSize).removeClass("hideTR")},Tab.prototype._updateCheckAll=function(){var e=this.getCheckAll();0==this.getCheckboxes().length||this.getChecked().length!=this.getCheckboxes().length?e.attr("checked",!1):e.attr("checked",!0)},Tab.prototype._updatePrevNextButtons=function(){var e=Math.ceil(this.getCount()/this.pageSize),t=this;this.page+1>e?$("."+this.name+"Next").hide():$("."+this.name+"Next").each(function(){$(this).attr("name",t.page+1).show()}),1>this.page-1?$("."+this.name+"Prev").hide():$("."+this.name+"Prev").each(function(){$(this).attr("name",t.page-1).show()})},Tab.prototype._drawMessage=function(e){$("html, body").scrollTop(0),log("--page: "+this.page),(2!=e.message.type||0!=e.message.ispaid)&&this.getTR(e.message.id).removeClass("unread");var t,a=this;t=""==e.message.photo_url&&"F"==e.message.gender?female_nophoto_url:""==e.message.photo_url&&"M"==e.message.gender?male_nophoto_url:e.message.photo_url,$("#profileImage .messageImage img").attr("src",t),$(".profileFloat .messageLink").html(getLang("View Profile")),$("#profileInfo").hide().html(""),nickname=e.message.nickname,6===e.message.type&&e.showPriorityReply===!0?$("#messageIcons #icon_priority").show():$("#messageIcons #icon_priority").hide();var i=e.message.extra.split("|");1==i[0]?$("#messageIcons #icon_privatekey").show():$("#messageIcons #icon_privatekey").hide(),$("#readSubject .infoSubject").html(getLangWink(e.message.subject)),$("#readDate .infoDate").html(e.message.date),$("#messageIcons #icon_privatekey a").attr("data-p","sent"==this.name?my_pnum:e.message.pnum),e.message.other_showcase&&"travelingman"!=this.name?$("#other_showcase").show():$("#other_showcase").hide(),$("#other_showcase a").attr("data-p","sent"==this.name?my_pnum:e.message.pnum),$("#private_showcase_container").html(""),e.message.other_showcase&&e.message.has_showcase_access?(showLoading(getLang("Loading...")),$.get("/app/private/member/showcase_p.p",{id:e.message.pnum},function(e){$("#private_showcase_container").html("<hr/>"+e),$("#showcase_button_back").hide(),$("#private_showcase_container").show()}),hideLoading()):$("#private_showcase_container").hide();var s="",o='<p></p><a href="javascript:void(0);" class="messageLink" id="historyLink">['+getLang("View message history")+']</a><p></p><div id="viewHistory" class="viewHistory"></div>',n=a.getState(),r=createHash(n);if($("#replyButton").attr("href",contact_base_url+"&id="+e.message.pnum+"&r="+e.message.id+"&s="+e.message.subject_url+"&from=inbox&hash="+r),e.noCr)s=7==e.message.type?'<div style="float: left;"> <div class="giftQuote" style="width: 360px;  min-height: 100px; height: auto !important; height: 100px; font-weight: bold; font-size: 14px;">'+e.message.message+"</div></div>"+'<div class="giftItem" align="center" style="float: right; padding-left: 20px;"><img align="center" src="'+img_base_url+"v2/private/gifts/gift_"+e.message.gift_url+'.png"><div class="giftTitle">'+getLang(e.message.gift_name)+'</div></div> <div style="clear: both; margin-bottom: 20px;"></div>':'<div class="giftQuote" style="margin: auto; width: 500px;  min-height: 100px; height: auto !important; height: 100px; font-weight: bold; font-size: 14px;">'+getLangWink(e.message.message)+"</div>";else if(7==e.message.type)s="<h3>"+getLang("Message")+":</h3>"+'<div style="float: left;"> <div class="giftQuote" style="width: 360px;  min-height: 100px; height: auto !important; height: 100px;">'+e.message.message+"</div></div>"+'<div class="giftItem" align="center" style="float: right; padding-left: 20px;"><img align="center" src="'+img_base_url+"v2/private/gifts/gift_"+e.message.gift_url+'.png" id="giftImage"><div class="giftTitle">'+getLang(e.message.gift_name)+'</div></div> <div style="clear: both; margin-bottom: 20px;"></div>',s+=o;else if(2==e.message.type&&0==e.message.ispaid)collect_msg_header=1==e.message.fs?"":"<h3>"+getLang("Collect Message")+":</h3>",s=collect_msg_header+getLangWink(e.message.message);else if(3==e.message.type&&e.message.subject=="("+e.message.nickname+") tried to contact you")s="<h3>"+getLang("Message")+":</h3>"+getLangWink(e.message.message)+"<p>"+getLang('To change your settings click <a href="%s">here</a>.').replace(/%s/,settings_url)+"</p>";else if(s=" ",e.message.must_pay&&(s+="<div class='paymentRequired'><span class='heading'>"+getLang("NOTE FROM ASHLEYMADISON.COM:")+"</span><br /> "+"<span class='message'>"+getLang("Congratulations!  We gave ")+e.message.nickname+getLang(" the opportunity to send out one free message and she chose to message You! To reply to her, we charge a one-time fee of 5 credits after which all messages between you and her are Free!")+"</span></div>",$("#replyButton").attr("href",payment_url)),"travelingman"==this.name){var h="F"==e.message.gender?getLang("Here is your receipt of Men messaged in the city of"):getLang("Here is your receipt of Women messaged in the city of");s+='<style type="text/css">#am-tm-users { list-style: none; padding: 0; } #am-tm-users li { float: left; padding: 5px; width: 300px; .width: 290px; } #am-tm-users li a { padding-right: 20px; } #am-tm-users li.odd { background: #efefef; } #am-tm-users span, #am-tm-users a { display: block; } #am-tm-users span { float: right; margin-right: 10px; } #am-tm-users a { float: left; } .clearfix:after { clear: both; display: block; } .clearfix { .zoom: 1; } .clearfix:after { content: " "; } </style><div style="font-weight: bold;">'+h+": "+e.message.address+".</div>"+'<div><ul id="am-tm-users">'+e.message.message+'</ul></div><div style="clear:both"></div>'}else s+="Sorry! Your Request for an Access Key was Declined."==e.message.subject?getLangWink(e.message.subject):"<h3>"+getLang("Message")+":</h3>"+getLangWink(e.message.message),s+=o;if($("#dynamicContent").html("").html(s),$("#historyLink").unbind("click").bind("click",function(){var t=$(this).html();return t=="["+getLang("View message history")+"]"?(""==$("#viewHistory").html()&&$("#viewHistory").load("/app/private/member/contact/history.p?id="+e.message.pnum+" link, table"),$(this).html("["+getLang("Hide message history")+"]"),$("#viewHistory").show()):($(this).html("["+getLang("View message history")+"]"),$("#viewHistory").hide()),!1}),"sent"!=this.name&&"travelingman"!=this.name&&"Private Showcase Access Key Request"==e.message.subject?e.message.have_showcase&&!e.message.showcase_access?($("#grantKey, #declineKey").show(),$("#grantKeyGrey, #declineKeyGrey").hide()):($("#grantKey, #declineKey").hide(),title=0==e.message.have_showcase?" :: "+getLang("You do not have any photos in your Private Showcase."):" :: "+getLang("You have already sent your Private Showcase key to")+" "+e.message.nickname+".",$("#grantKeyGrey, #declineKeyGrey").show().attr("title",title).myTooltip()):$("#grantKey, #declineKey, #grantKeyGrey, #declineKeyGrey").hide(),3==e.message.type&&"You Have an Admirer!"==e.message.subject?1==e.message.is_favorite?($("#addToFavorites").hide(),$("#addToFavoritesGrey").show()):($("#addToFavorites").unbind("click").bind("click",function(){var t={};t.method="addToFavorites",t.pnum=e.message.pnum;var i="<b>"+e.message.nickname+"</b> "+getLang("has been added to your favorites.");showLoading(getLang("Adding %s to your favorites...").replace(/%s/,e.message.nickname)),$.post(ajax_url,t,function(e){e.success?($("#addToFavorites").hide(),$("#addToFavoritesGrey").show(),hideLoading(i)):(a.error(e.reason),hideLoading())},"json")}).show(),$("#addToFavoritesGrey").hide()):($("#addToFavorites").hide(),$("#addToFavoritesGrey").hide()),$(".profileFloat .messageLink").unbind("click").bind("click",function(){var t=this,a=jQuery(this).html();if(a==getLang("View Profile"))if(""==jQuery("#profileInfo").html()){var i={};i.method="getProfileHtml",i.pnum=e.message.pnum,jQuery(t).html(getLang("Loading...")),jQuery.post(ajax_url,i,function(e){jQuery("#profileInfo").html(e.html),jQuery(t).html(getLang("Hide Profile")),jQuery("#profileInfo").show()},"json")}else jQuery(this).html(getLang("Hide Profile")),jQuery("#profileInfo").show();else jQuery(this).html(getLang("View Profile")),jQuery("#profileInfo").hide();return!1}),2==e.message.type&&0==e.message.ispaid&&($("#declineCollect").unbind("click").bind("click",function(){var t={};t.method="declineCollect",t.pnum=e.message.pnum,t.id=e.message.id;var i=e.message.id;showLoading(),$.post(ajax_url,t,function(){$("#declineCollect").hide(),a.getTR(i).find(".rowSubjectLine").html(getLang('<b>"Collect Message"</b> - Declined')),hideLoading(getLang("The collect message has been declined."))},"json")}),$("#acceptCollect").unbind("click").bind("click",function(){$("#acceptCollect").unbind("click"),$("#declineCollect").unbind("click"),$("#collectButton").hide();var t={};t.method="acceptCollect",t.pnum=e.message.pnum,t.id=e.message.id;var i=e.message.id;showLoading(getLang("Processing...")),$.post(ajax_url,t,function(e){hideLoading(),e.success?(a.getTR(i).find(".rowSubjectLine").html(getLang('<b>"Collect Message"</b> - Accepted')),a._drawMessage(e),"function"==typeof refreshCredits&&refreshCredits()):a.error(e.reason)},"json")}),$("#popupSubscription").unbind("click").bind("click",function(){jQuery.ashleymodal.show({url:subscription_modal_url,height:240,width:700,borderradius:12}),jQuery("html.ipad #ashley-modal").css({left:"500px",top:"200px",position:"absolute"})})),(2==e.message.type&&1==e.message.ispaid||3==e.message.type&&("Wink Message"==e.message.subject||"What Really Turns Me On About You..."==e.message.subject||"I Can't Wait To Tell You About..."==e.message.subject))&&"F"==e.message.gender&&"sent"!=this.name&&1==e.showPriorityReply){var c=a.getState(),l=createHash(c),g=contact_base_url+"&id="+e.message.pnum+"&r="+e.message.id+"&s="+e.message.subject_url+"&from=inbox&hash="+l+"&is_priority=1";e.noCr||($("#priorityReply").attr("href",g).show(),$.browser.msie&&$("html.ie8 #priorityReply").each(function(){this.fireEvent("onmove")}),$("html.ie8 #priorityReply").prev().show())}else $("#priorityReply").hide();$("#viewLast").unbind("click").bind("click",function(){$("#viewLast").html()=="["+getLang("Hide your last message sent")+"]"?($("#lastMessage").slideUp(),$("#viewLast").html("["+getLang("View your last message sent")+"]")):($("#lastMessage").slideDown(),$("#viewLast").html("["+getLang("Hide your last message sent")+"]"))}),$("#keyaccess #grantKey").unbind("click").bind("click",function(){var t={};t.method="grantKey",t.pnum=e.message.pnum,t.id=e.message.id;var i=e.message.id,s=e.message.nickname;$.post(ajax_url,t,function(e){e.success?(showNote(getLang("Private Showcase Access Key Request (Granted)")),$("#grantKey, #declineKey").hide(),$(" #grantKeyGrey, #declineKeyGrey").show().attr("title"," :: "+getLang("The Private Showcase has been granted to %s.").replace(/%s/,s)).myTooltip(),a.getTR(i).find(".rowSubjectLine").html(getLang("Private Showcase Access Key Request (Granted)"))):a.error(e.reason)},"json")}),$("#keyaccess #declineKey").unbind("click").bind("click",function(){var t={};t.method="declineKey",t.pnum=e.message.pnum,t.id=e.message.id;var i=e.message.id,s=e.message.nickname;$.post(ajax_url,t,function(){var e=getLang("You have declined %s to access your Private Showcase.").replace(/%s/,s);showNote(e),$("#grantKey, #declineKey").hide(),$(" #grantKeyGrey, #declineKeyGrey").show().attr("title"," :: "+e).myTooltip(),a.getTR(i).find(".rowSubjectLine").html(getLang("Private Showcase Access Key Request (Declined)"))},"json")}),$.cookie("from_url"+my_pnum,inbox_url+"&hash="+r,{path:"/",domain:cookie_domain}),$("#saveButton").unbind("click").bind("click",function(){var t={},i=e.message.id,s=e.message.subject;s="Wink Message"==s||"What Really Turns Me On About You..."==s||"I Can't Wait To Tell You About..."==s||"You Have an Admirer!"==s||'Access to Private Showcase Attached. Please click the "key" icon.'==s||"Access Revoked"==s?getLangWink(s):getLang(s),t.method="saveMessage",t.id=i,$.post(ajax_url,t,function(e){e.success?(a._saveTR(i),$("#backButton").click(),showNote(getLang("The message [%s] has been saved.").replace(/%s/,s))):a.error(e.reason)},"json")}),$("#deleteButton").unbind("click").bind("click",function(){if(confirm(getLang("Are you sure you would like to delete this message?"))){var t={},i=e.message.id,s=e.message.subject;s="Wink Message"==s||"What Really Turns Me On About You..."==s||"I Can't Wait To Tell You About..."==s||"You Have an Admirer!"==s||'Access to Private Showcase Attached. Please click the "key" icon.'==s||"Access Revoked"==s?getLangWink(s):getLang(s),t.method="deleteMessage",t.ids=i,t.mailbox=a.name,$.post(ajax_url,t,function(e){e.success?(a._deleteTR(i),$("#backButton").click(),showNote(getLang("The message [%s] has been deleted.").replace(/%s/,s))):a.error(e.reason)},"json")}}),"inbox"!=this.name?$("#reportButton").hide():$("#reportButton").show().unbind("click").bind("click",function(){if(confirm(getLang("Are you sure would like to report this profile?"))){var t={};t.method="reportForReview",t.id=e.message.id,showLoading(),$.post(ajax_url,t,function(){hideLoading(getLang("This profile has been reported for review."))},"json")}}),$("#backButton").unbind("click").bind("click",function(){var e=a.getState();e.messageId=0,log("load back button"),$.historyLoad(createHash(e))}),"sent"==this.name||"travelingman"==this.name||2==e.message.type&&0==e.message.ispaid?$("#replyButton").parent().removeClass("hideElement").addClass("hideElement"):$("#replyButton").parent().removeClass("hideElement"),"inbox"==this.name||"wink"==this.name?($("#saveButton").parent().removeClass("hideElement"),$("#saveDivider").removeClass("hideElement")):($("#saveButton").parent().removeClass("hideElement").addClass("hideElement"),$("#saveDivider").removeClass("hideElement").addClass("hideElement"));var d="<span class='messageRecipient'>"+nickname+"</span>";if("sent"==this.name||"travelingman"==this.name)var m="<span class='infoLabel'>"+getLang("mailbox.addressed.to.text.js")+"</span>",p=getLang("mailbox.addressed.js").replace(/%s/,m);else var u="<span class='infoLabel'>"+getLang("mailbox.addressed.from.text.js")+"</span>",p=getLang("mailbox.addressed.js").replace(/%s/,u);p=p.replace(/%n/,d),$("#messageName").html(p),$(".mailboxWrapper").hide(),$("#messageWrapper").show()},Tab.prototype.showLoading=function(){$("#"+this.name+"ActionBar .ajaxLoader").show()},Tab.prototype.hideLoading=function(){$("#"+this.name+"ActionBar .ajaxLoader").hide()},Tab.prototype.deleteMessage=function(e){this._deleteTR(e),this.currentMessageId=0,isScrollTop=!1,this.draw()},Tab.prototype._deleteTR=function(e){var t;for(t=0;this.sortedIds.length>t&&this.sortedIds[t]!=e;t++);this.sortedIds.length>t&&this.sortedIds.splice(t,1),this.getTR(e).remove()},Tab.prototype._saveTR=function(e){var t=tabs.getTabObject("saved");t.clearDatagrid(),t.setCount(t.getCount()+1),this._deleteTR(e)},Tab.prototype.deleteMessages=function(e){var t=this;$.each(e,function(e,a){t._deleteTR(a)}),isScrollTop=!1,this.draw()},Tab.prototype.error=function(e){alert(e)},Tab.prototype.infoMsg=function(e){alert(e)},Tab.prototype._registerEventsForTR=function(e){var t=this;e.hover(function(){$(this).hasClass("inboxNormalRow")?$(this).addClass("inboxNormalRowHover"):$(this).hasClass("inboxGiftRow")?$(this).addClass("inboxGiftRowHover"):$(this).hasClass("inboxPriorityRow")&&$(this).addClass("inboxPriorityRowHover")},function(){$(this).hasClass("inboxNormalRow")?$(this).removeClass("inboxNormalRowHover"):$(this).hasClass("inboxGiftRow")?$(this).removeClass("inboxGiftRowHover"):$(this).hasClass("inboxPriorityRow")&&$(this).removeClass("inboxPriorityRowHover")}),$("input:checkbox",e).click(function(){t._updateCheckAll()}),$("a.deleteMsg",e).click(function(){var e={},a=$(this).parent().parent().find("input[type=checkbox]").attr("id");e.method="deleteMessage",e.ids=a,e.mailbox=t.name,$.post(ajax_url,e,function(e){e.success?t.deleteMessage(a):t.error(e.reason)
},"json")}),$("td.rowSubject",e).click(function(){var e=t.getState();e.messageId=parseInt($(this).parent().find("input[type=checkbox]").attr("id")),log("load view message stateArg.mailbox:"+e.mailbox),$.historyLoad(createHash(e))}),$(".jtooltipLite",e).tooltip({track:!0,delay:0,showBody:" :: ",opacity:.99,showURL:!1})},Tab.prototype._initPrivateShowcase=function(e){var t=this;this.isDataReady=!0,this.sortedIds=[],e.ids!==void 0&&e.ids.length>0&&($.each(e.ids,function(){t.sortedIds.push(this)}),this.setCount(this.sortedIds.length))},Tab.prototype._showPrivateShowcase=function(e){var t=this,a=t.getState(),i=createHash(a);$.cookie("from_url"+my_pnum,inbox_url+"&hash="+i,{path:"/",domain:cookie_domain});var s=(a.page-1)*this.pageSizePrivateShowCase,o=s+this.pageSizePrivateShowCase-1;this._drawPrivateShowcasePhotoSection(e,s,o),this._updatePrivateShowcasePagination(s,o,a)},Tab.prototype._redrawPrivateShowcase=function(){var e=this,t=e.getState(),a=createHash(t);$.cookie("from_url"+my_pnum,inbox_url+"&hash="+a,{path:"/",domain:cookie_domain});var s=[];$("#photoMain").find(".profileFrame").each(function(){"photoSectionSample"!=this.id&&s.push(this.id)});var o=s.length,n=[];$("#photoMain").find(".profileFrame").each(function(){"photoSectionSample"!=this.id&&"block"==jQuery("#"+this.id).css("display")&&n.push(this.id)});var r=n.length,h=t.page,c=Number(e.pageSizePrivateShowCase);0==r&&h--,1>h&&(h=1);var l=(h-1)*c,g=l+c-1;for(i=0;o>i;i++)i>=l&&g>=i?$("#"+s[i]).show():$("#"+s[i]).hide();this._updatePrivateShowcasePagination(l,g,t)},Tab.prototype._updatePrivateShowcasePagination=function(e,t,a){var i=this,s=Math.ceil(this.getCount()/this.pageSizePrivateShowCase);this.page>s&&(this.page=s),this._updatePrevNextButtonsPrivateShowcase(),$("."+this.name+"Prev, ."+this.name+"Next").each(function(){$(this).unbind("click").bind("click",function(){var e=i.getState();e.page=parseInt($(this).attr("name")),$.historyLoad(createHash(e))})}),e+=1,t+=1,t>a.count&&(t=a.count),e>t?$("."+this.name+"MessageRange").html(""):$("."+this.name+"MessageRange").html(e+"-"+t),$("html,body").scrollTop(0)},Tab.prototype._updatePrevNextButtonsPrivateShowcase=function(){var e=Math.ceil(this.getCount()/this.pageSizePrivateShowCase),t=this;this.page+1>e?$("."+this.name+"Next").hide():$("."+this.name+"Next").each(function(){$(this).attr("name",t.page+1).show()}),1>this.page-1?$("."+this.name+"Prev").hide():$("."+this.name+"Prev").each(function(){$(this).attr("name",t.page-1).show()})},Tab.prototype._drawPrivateShowcasePhotoSection=function(e,t,a){var s;for(s=e.photo!==void 0?e.photo.length:0,this._updatePrivateShowcasePhotoCount(s),this._updateViewRatedPhotoNotice(e.viewing_rated,e.rated_photos_count),i=0;s>i;i++)i>=t&&a>=i?this._drawPrivateShowcaseBlock(e.photo[i],"show"):this._drawPrivateShowcaseBlock(e.photo[i],"hide")},Tab.prototype._updatePrivateShowcasePhotoCount=function(e){0>e&&(e=0);var t=getLang("You have received %s private showcase key message(s).").replace(/%s/,e);$("#photo").find(".messageItems").html(e),$("#photoKeyCount").text(t)},Tab.prototype._updateViewRatedPhotoNotice=function(e,t){1==e?($(".hideRatedPhotoLink").unbind("click").bind("click",function(){updateViewRatedPhotoRule("off"),$.cookie("hideNoticeFor"+my_pnum,null,{path:"/",domain:cookie_domain})}),$(".hideRatedPhotoLink").show(),$("#ratedPhotoBlock").show()):t>0&&($(".showRatedPhotoLink").unbind("click").bind("click",function(){updateViewRatedPhotoRule("on")}),$("#ratedPhotoBlockClose").unbind("click").bind("click",function(){$("#ratedPhotoBlock").hide(),$.cookie("hideNoticeFor"+my_pnum,"yes",{path:"/",domain:cookie_domain})}),"yes"!=$.cookie("hideNoticeFor"+my_pnum)&&($(".showRatedPhotoBlock").show(),$("#ratedPhotoBlock").show()))},Tab.prototype._drawPrivateShowcaseBlock=function(e,t){var a=e.p;if(0!=$("#"+a).length)return"hide"==t?$("#"+a).hide():$("#"+a).show(),void 0;var i=$("#photoSectionSample"),s=i.clone().attr("id",a);s.insertBefore($("#photoFrameEnd")),"hide"==t&&$("#"+a).hide(),e.ps[0]!==void 0&&($("#"+a).find(".big_portrait img").attr("src",e.ps[0].photo_url_large),$("#"+a).find(".big_portrait a").attr("href",e.ps[0].photo_url_large),$("#"+a).find(".big_portrait a").addClass("photoEffectGroup")),$("#"+a).find(".overlay-name").text(e.n),$("#"+a).find(".overlay-wrapper a").attr("href","/app/private/member/profile.p?id="+e.p);for(var o=[],n=0;;){if(void 0===e.ps[n])break;var r=e.ps[n].photo_url_large;o[n]=r,n>0&&$("#"+a+" .other_pics").append('<a href="'+r+'" class="photoEffectGroup">'),$("#"+a+" .paper"+n).show(),n++}$("#"+a+" .big_portrait img").iskip({images:o,method:"mousemove",cycle:3}),$("#"+a+" .photoCount").text(e.ps.count_text),bindLightBoxListener($("#"+a+" .photoEffectGroup")),$("#"+a).find(".messageMe").attr("href","/app/private/member/contact/contact.p?id="+e.p);var h=this;$("#"+a).find(".big .btn-close").unbind("click").bind("click",function(){modalConfirm(getLang("Confirmation"),getLang("Are you sure you would like to delete this message?"),function(){var t={};t.method="hideShowcaseMessage",t.ids=e.ml,$.post(ajax_url,t,function(e){if(e.success){var t=$("#photo").find(".messageItems").html();h._updatePrivateShowcasePhotoCount(t-1),$("#"+a).hide(500),setTimeout("$('#"+a+"').remove();",600),setTimeout(function(){h._redrawPrivateShowcase()},620)}},"json")})}),bindListeners()},Datagrid.prototype.appendRows=function(){var e=this,t=tabs.getTabObject(this.mailbox),a=t.getTbody(),i=(new Date).getTime(),s=[];$.each(this.data.messages,function(){s.push(e.generateRowHtml(this))}),((new Date).getTime()-i)/1e3,a.append(s.join("")),((new Date).getTime()-i)/1e3,window.fixMessageMaxWidth=!1,$.each(this.data.messages,function(){t._registerEventsForTR(t.getTR(this.id)),rowSubjectWidth=$("#rs"+this.id).width(),rowSubjectHeight=$("#rs"+this.id).height(),rowSubjectHeight>50&&(window.fixMessageMaxWidth=!0)}),$.each(this.data.messages,function(){window.fixMessageMaxWidth&&($("#rs"+this.id).width(400),rowSubjectHeight=$("#rs"+this.id).height(),rowSubjectHeight>50&&$("#rs"+this.id).height(rowSubjectHeight+10));var e=$("#rf"+this.id+" .fromDetails"),t=parseInt(e.width())+105;$("#rf"+this.id).width(t)})},Datagrid.prototype.generateRowHtml=function(e){var t,a=e.p,i=e.e.split("|");t=7==e.t?"inboxGiftRow":6==e.t?"inboxPriorityRow":"inboxNormalRow","inbox"!=this.mailbox||1!=e.st||0==e.m.length&&2!=e.t||(t+=" unread"),"saved"!=this.mailbox&&parseInt(e.c)<this.warn_time&&(t+=" tobedeleted");var s='<tr class="'+t+'" id="t'+e.id+'">',o=[];o.push('<td class="rowCheck"><input type="checkbox" id="'+e.id+'" class="jtooltipLite" title=" :: '+getLang("Check this message to be deleted")+'"/></td>');var n,r=profile_base_url+a;if(n=""!=this.data.members[a].p?this.data.members[a].p:"M"==this.data.members[a].g?male_nophoto_url:female_nophoto_url,o.push('<td class="rowFrom" id="rf'+e.id+'"><div class="fromImage"><div class="crop"><a href="'+r+'" class="jtooltipLite" title=" :: '+getLang("View Profile")+'"><img src="'+n+'" border="0" /></a></div></div><div class="fromDetails"><a href="'+r+'" class="fromName jtooltipLite" title=" :: '+getLang("View Profile")+'">'+this.data.members[a].n+'</a><div class="fromAddress">'+this.data.members[a].a+" - "+this.data.members[a].c+", "+this.data.members[a].sr+'</div></div><div class="clearboth"></div></td>'),7==e.t)content='<a class="rowSubjectLine" href="javascript:void(0);">'+getLang("You have received a gift!")+"</a>";else{var h="";h=35>getLangWink(e.su).length?getLangWink(e.su):getLangWink(e.su)+"...",content='<a class="rowSubjectLine" href="javascript:void(0);">'+h+"</a>"}return o.push('<td class="rowSubject jtooltipLite" id="rs'+e.id+'" title=" :: '+getLang("View Message")+'">'+content+'<div class="fromDate">'+getLang("Received")+" "+e.d+"</div></td>"),content=void 0==this.data.members[a].s?"":'<span class="jtooltipLite" title=" :: '+this.data.members[a].s+'"><b>H</b></span>',content+=7==e.t?'<img src="'+gift_icon_url+'">':"",1==i[7]?content+='<img border="0" src="'+travelingman_icon_url+'" class="jtooltipLite" title=" :: '+getLang("This member is traveling to your city.")+'">':6==e.t&&(content+='<img class="priorityFlag jtooltipLite" src="'+priority_icon_url+'" title=" :: '+getLang("Priority Status Message")+'" />'),content+=3==e.t&&1==i[5]?'<img src="'+admirer_icon_url+'">':"",content+=2==e.t&&0==e.fs?'<img src="'+collect_icon_url+'" class="jtooltipLite" title=" :: '+getLang("Collect Message")+'">':"",1==i[0]&&(content+='<a href="javascript:requestShowcase('+("sent"==this.mailbox?my_pnum:a)+')"><img border="0" src="'+key_icon_url+'" '+("sent"==this.mailbox?"":'class="jtooltipLite" title=" :: '+getLang("This member has sent you access to their private photos")+'"')+"></a>"),"saved"!=this.mailbox&&parseInt(e.c)<this.warn_time&&(content+='<img src="'+alert_icon_url+'" class="jtooltipLite" title=" :: '+getLang("Message queued for deletion")+'">'),"sent"!=this.mailbox&&"travelingman"!=this.mailbox&&1==i[3]&&(content+='<img src="'+replied_icon_url+'" class="jtooltipLite" title=" :: '+getLang("Message has been replied to ")+'" />'),""==content?o.push('<td class="rowIcons">&nbsp;</td>'):o.push('<td class="rowIcons">'+content+"</td>"),o.push('<td class="rowDelete"><a href="javascript:void(0);" class="deleteMsg jtooltipLite" title=" :: '+getLang("Delete this message")+'"></a></td>'),s+o.join("")+"</tr>"},function(e){e.fn.myTooltip=function(){e(this).tooltip({track:!0,delay:0,showBody:" :: ",opacity:.99,showURL:!1})}}(jQuery);